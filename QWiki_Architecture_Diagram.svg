<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1800 1000" font-family="Arial, sans-serif" font-size="14">
    <style>
        .container { fill: #F5F5F5; stroke: #E0E0E0; stroke-width: 1; }
        .component { fill: #FFFFFF; stroke: #B0BEC5; stroke-width: 2; rx: 8; ry: 8; }
        .sub-component { fill: #ECEFF1; stroke: #90A4AE; stroke-width: 1.5; rx: 5; ry: 5; }
        .data-source { fill: #E3F2FD; stroke: #64B5F6; stroke-width: 2; rx: 8; ry: 8; }
        .external-service { fill: #FFF3E0; stroke: #FFB74D; stroke-width: 2; rx: 8; ry: 8; }
        .db { fill: #C8E6C9; stroke: #81C784; stroke-width: 2; }
        .arrow { marker-end: url(#arrowhead); stroke: #546E7A; stroke-width: 1.5; fill: none; }
        .arrow-dashed { marker-end: url(#arrowhead); stroke: #546E7A; stroke-width: 1.5; stroke-dasharray: 5,5; fill: none; }
        .text-title { font-size: 24px; font-weight: bold; fill: #37474F; }
        .text-component { font-weight: bold; fill: #263238; }
        .text-label { font-size: 12px; fill: #546E7A; }
        .text-flow { font-size: 12px; font-style: italic; fill: #455A64; }
    </style>

    <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#546E7A" />
        </marker>
    </defs>

    <!-- Main Title -->
    <text x="900" y="40" text-anchor="middle" class="text-title">QWiki - RAG Architecture Diagram</text>

    <!-- Containers -->
    <rect x="20" y="80" width="360" height="880" class="container" />
    <text x="200" y="110" text-anchor="middle" class="text-component">Data Sources</text>

    <rect x="400" y="80" width="900" height="880" class="container" />
    <text x="850" y="110" text-anchor="middle" class="text-component">QWiki Application</text>

    <rect x="1320" y="80" width="460" height="880" class="container" />
    <text x="1550" y="110" text-anchor="middle" class="text-component">External Services & Configuration</text>

    <!-- Data Sources -->
    <g id="data-sources">
        <rect x="50" y="140" width="300" height="60" class="data-source" />
        <text x="200" y="175" text-anchor="middle">Azure DevOps Wiki</text>
        <rect x="50" y="220" width="300" height="60" class="data-source" />
        <text x="200" y="255" text-anchor="middle">PDF Documents (wwwroot/Data)</text>
        <rect x="50" y="300" width="300" height="60" class="data-source" />
        <text x="200" y="335" text-anchor="middle">PPT Documents (wwwroot/Data)</text>
        <rect x="50" y="380" width="300" height="60" class="data-source" />
        <text x="200" y="415" text-anchor="middle">Brownbag Transcripts</text>
        <rect x="50" y="460" width="300" height="60" class="data-source" />
        <text x="200" y="495" text-anchor="middle">Right Answers Articles</text>
        <rect x="50" y="540" width="300" height="100" class="data-source" style="stroke-dasharray: 5,5; fill: #F1F8E9;"/>
        <text x="200" y="580" text-anchor="middle">Future Extensions:</text>
        <text x="200" y="605" text-anchor="middle">Office Docs, Meeting Transcripts</text>
    </g>

    <!-- QWiki Application -->
    <g id="qwiki-app">
        <!-- Frontend -->
        <rect x="450" y="140" width="800" height="100" class="component" />
        <text x="850" y="170" text-anchor="middle" class="text-component">Frontend</text>
        <text x="850" y="200" text-anchor="middle">ASP.NET Core Web App with JavaScript UI</text>
        
        <!-- User Query -->
        <path class="arrow" d="M850,140 v-40" />
        <text x="850" y="85" text-anchor="middle" class="text-flow">User Query</text>
        <path class="arrow" d="M850,240 v 40" />
        <text x="850" y="265" text-anchor="middle" class="text-flow">Generated Response</text>

        <!-- RAG Pipeline -->
        <rect x="450" y="290" width="800" height="650" class="component" />
        <text x="850" y="320" text-anchor="middle" class="text-component">Backend: RAG Pipeline</text>

        <!-- Ingestion -->
        <g id="ingestion-pipeline">
            <rect x="480" y="350" width="340" height="560" class="sub-component" />
            <text x="650" y="380" text-anchor="middle" class="text-component">Document Ingestion & Processing</text>
            
            <rect x="500" y="410" width="300" height="60" class="sub-component" />
            <text x="650" y="445" text-anchor="middle">1. Document Ingestion Layer</text>
            
            <rect x="500" y="510" width="300" height="60" class="sub-component" />
            <text x="650" y="545" text-anchor="middle">2. Document Chunking</text>
            
            <rect x="500" y="610" width="300" height="60" class="sub-component" />
            <text x="650" y="645" text-anchor="middle">3. Embedding Generation</text>
            
            <rect x="500" y="710" width="300" height="60" class="sub-component" />
            <text x="650" y="745" text-anchor="middle">4. Store in Vector DB</text>

            <!-- Ingestion Arrows -->
            <path class="arrow" d="M500,470 v 40" />
            <path class="arrow" d="M500,570 v 40" />
            <path class="arrow" d="M500,670 v 40" />
        </g>

        <!-- Query/Response Flow -->
        <g id="query-response-flow">
            <rect x="880" y="350" width="340" height="560" class="sub-component" />
            <text x="1050" y="380" text-anchor="middle" class="text-component">Query & Response Generation</text>

            <rect x="900" y="410" width="300" height="60" class="sub-component" />
            <text x="1050" y="445" text-anchor="middle">1. Embed User Query</text>

            <rect x="900" y="510" width="300" height="60" class="sub-component" />
            <text x="1050" y="545" text-anchor="middle">2. Semantic Search (Vector DB)</text>

            <rect x="900" y="610" width="300" height="60" class="sub-component" />
            <text x="1050" y="645" text-anchor="middle">3. Retrieve Relevant Chunks</text>

            <rect x="900" y="710" width="300" height="60" class="sub-component" />
            <text x="1050" y="745" text-anchor="middle">4. Generate Response</text>
            
            <rect x="900" y="810" width="300" height="60" class="sub-component" />
            <text x="1050" y="835" text-anchor="middle">5. Add Source Citations</text>
            <text x="1050" y="855" text-anchor="middle" class="text-label">(Source Reference Tracking)</text>

            <!-- Query/Response Arrows -->
            <path class="arrow" d="M900,470 v 40" />
            <path class="arrow" d="M900,570 v 40" />
            <path class="arrow" d="M900,670 v 40" />
            <path class="arrow" d="M900,770 v 40" />
        </g>
    </g>

    <!-- Vector DB -->
    <g id="vector-db">
        <ellipse cx="850" cy="740" rx="150" ry="40" class="db" />
        <text x="850" y="735" text-anchor="middle" class="text-component">Vector Database</text>
        <text x="850" y="755" text-anchor="middle" class="text-label">(Embeddings Store)</text>
    </g>

    <!-- External Services & Config -->
    <g id="external-services">
        <rect x="1370" y="140" width="360" height="100" class="external-service" />
        <text x="1550" y="170" text-anchor="middle" class="text-component">GitHub Models API</text>
        <text x="1550" y="200" text-anchor="middle">For Embeddings &amp; Response Generation</text>

        <rect x="1370" y="260" width="360" height="80" class="external-service" />
        <text x="1550" y="300" text-anchor="middle" class="text-component">Azure DevOps API</text>

        <rect x="1370" y="360" width="360" height="100" class="component" style="fill: #FBE9E7; stroke: #FF8A65;"/>
        <text x="1550" y="390" text-anchor="middle" class="text-component">Configuration Management</text>
        <text x="1550" y="420" text-anchor="middle">appsettings.json</text>
        <text x="1550" y="440" text-anchor="middle">User Secrets (API Tokens)</text>
    </g>

    <!-- Arrows between major components -->
    <g id="main-arrows">
        <!-- Data Ingestion Flow -->
        <path class="arrow" d="M350,330 h 150" />
        <text x="425" y="325" text-anchor="middle" class="text-flow">Ingest</text>
        <path class="arrow-dashed" d="M1300,300 h 70" />
        <text x="1335" y="295" text-anchor="middle" class="text-flow">API Key</text>
        <path class="arrow" d="M350,175 h 150" />
        <path class="arrow" d="M350,255 h 150" />
        <path class="arrow" d="M350,415 h 150" />
        <path class="arrow" d="M350,495 h 150" />
        <path class="arrow-dashed" d="M350,585 h 150" />

        <!-- Ingestion to ADO API -->
        <path class="arrow" d="M820,440 h 550" />
        <text x="1085" y="435" text-anchor="middle" class="text-flow">Fetch Wiki Content</text>

        <!-- Embedding Generation to GitHub API -->
        <path class="arrow" d="M820,645 h 550" />
        <text x="1085" y="640" text-anchor="middle" class="text-flow">Generate Embeddings</text>
        <path class="arrow" d="M1370,190 h -170" />
        <text x="1285" y="185" text-anchor="middle" class="text-flow">Embeddings</text>

        <!-- Ingestion to Vector DB -->
        <path class="arrow" d="M650,770 v 20 h 120" />
        <text x="710" y="785" text-anchor="middle" class="text-flow">Store</text>

        <!-- Query Embedding to GitHub API -->
        <path class="arrow" d="M1200,445 h 170" />
        <text x="1285" y="440" text-anchor="middle" class="text-flow">Embed Query</text>
        <path class="arrow" d="M1370,170 h -270" />
        <text x="1235" y="165" text-anchor="middle" class="text-flow">Query Embedding</text>

        <!-- Semantic Search to Vector DB -->
        <path class="arrow" d="M880,545 h -60" />
        <text x="850" y="570" text-anchor="middle" class="text-flow">Search</text>
        <path class="arrow" d="M820,645 h 60" />
        <text x="850" y="620" text-anchor="middle" class="text-flow">Retrieve</text>

        <!-- Response Generation to GitHub API -->
        <path class="arrow" d="M1200,745 h 170" />
        <text x="1285" y="740" text-anchor="middle" class="text-flow">Query + Context</text>
        <path class="arrow" d="M1370,210 h -270" />
        <text x="1235" y="205" text-anchor="middle" class="text-flow">Generated Text</text>

        <!-- Config to APIs -->
        <path class="arrow-dashed" d="M1370,380 v -70" />
        <path class="arrow-dashed" d="M1370,380 v -190" />
        <text x="1340" y="300" text-anchor="middle" class="text-label" transform="rotate(-90 1340 300)">API Keys</text>
        
        <!-- Real-time updates -->
        <path class="arrow" d="M480,910 h -130 a 10 10 0 0 1 -10 -10 v -600 a 10 10 0 0 1 10 -10 h 10" />
        <text x="300" y="650" text-anchor="middle" class="text-flow">Real-time Updates</text>
    </g>
</svg>
